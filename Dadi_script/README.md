#  ***Dadi***
Here you will find my scripts for *dadi* simulation

## Where to download the version used
The modified version of dadi used can be download from there [Gitlab_Khalid_Dadi](https://gitlab.mbb.univ-montp2.fr/khalid/dadi/-/tree/master).                           
This version used an *dual annealing* function to find the optimized likelihood.

**!!! Caution !!!** : I'm also using an python environnement to install and run *dadi* within it, conda environnement should also work.
Direct installation of *dadi* in a linux environnement doesn't need to load a special environnement such as i do.
If a direct installation is used juste comment each line "source activate dadi_sim".
## VCF to dadi format file
To generate a spectrum file from a vcf, i used a personnal script adapted from the exemple taken from [official site from dadi](https://dadi.readthedocs.io/en/latest/user-guide/importing-data/). 
To run this script, you have to give several arguments in the order given in the command below. 

``` 
python3 fs_from_VCF_arg.py myVCF my_popmap_file 50 outputname pop1 pop2 
``` 
this will generate two files, a spectrum file and a figure associated with this spectrum.

Dont hesitate to open the script to see what it does, in my case, i always exclude singleton. 

## Model type
These scripts contained 28 divergence models of 2 populations.  All these models have been rewritten with very slight changes and come from [Rougueux et al.,2017](https://doi.org/10.1093/gbe/evx150).                                                                                                                                 
**Don't forget to cite them when used these models, aswell as dadi papers.**
We have added the IM2N2M and IM2N2mG models and we have considerer population growth (G) only during the migration phase in (IM/AM/SC) models.

You will find 2 version of the same models display in the figure below.
1. Call *model_no_NA* which contained all the models with no change on the ancestral population prior the split/divergence. **Exemple figure A)** 
2. Call *model_NA_Change* which contained all the models with a change on the ancestral population prior the split/divergence. **Exemple figure B)**

This change is to simulate instaneous population bottleneck or expansion before the split, as done in  [Momigliano et al., 2021](https://doi.org/10.1093/molbev/msab047).


!!! depending on which type of model you want use, change the name of the script *call_all_model_NA_change.py* to *call_all_model_no_NA_change.py* in the bash script or in the command in the terminal !!!

## Model exemple
![Dessin_model_Nachange_noNa](https://user-images.githubusercontent.com/84977797/135247836-5f909cd9-d56e-430e-a3c8-7adb79249ef7.png)

## How to run simulation with these scripts
There is two main way to run these scripts.

### Using the bash scritp to launch multiple job

You will need to put all the scripts in one folder and then use only the bash script  **Multi_Launch_dadi.sh**.
In this following script, you have to write the name of your Spectrum file generated by *dadi*
``` 
FS=my_sprectrum_file_nam
``` 

then in these lines, you will need to write each model name you want to run and the number of independent runs you will perform.
In the following exemple, i ran two models **SC2N2m** and **AM2N2m** for 11 idependent runs.
``` 
for model in SC2N2m AM2N2m;
do
for i in `seq 1 11`;
do
``` 

### Direct run 
You can also run the command directly from the terminal where you have to give 3 arguments to perform the simulation:

1. model used for exemple.  > **IM2m**
2. spectrum file
3. the iteration (must be an integer)

For exemple, i ran a simulation for the model **IM2m** for the 9th run on the *noNA_change* models
```
python3 call_all_model_noNA_change.py IM2m my_spectrum_file_name 9 
```

### Writing additionnal model within these scripts

If you're new to this, see the *dadi* [tutorial page](https://dadi.readthedocs.io/en/latest/), model writing is well explained.

To add model in these scripts, whenever on which type of models you want to write (*with NA_change or no_Na_Change* scripts).
You have to open the respectively named scripts (*model_NA_change.py or model_No_NA_change.py*) and add you model as a functions at the end of theses scripts.
Then, you will have to add your model and parameters bound at the end of the  ***elif*** condition as other models in the **Call_all_model** python script.




