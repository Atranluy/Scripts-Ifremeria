#  ***Dadi***
Here you will find my scripts for *dadi* simulation

## Where to download the version used 
The modified version of dadi used can be download from there [Gitlab_Khalid_Dadi](https://gitlab.mbb.univ-montp2.fr/khalid/dadi/-/tree/master).                           
This version used an *dual annealing* function to find the optimized likelihood 

**!!! Caution !!!** : I'm also using an python environnement to install and run *dadi* within it, conda environnement should also work.
Direct installation of *dadi* in a linux environnement doesn't need to load a special environnement such as i do.
If direct installation is used juste comment each line "source activate dadi_sim" with an #

## Model type
You will find 2 version of the same models display in the figure below.
1. Call *model_no_NA* which contained all the models with no change on the ancestral population prior the split/divergence. **Exemple figure A)** 
2. Call *model_NA_Change* which contained all the models with a change on the ancestral population prior the split/divergence. **Exemple figure B)**

This change is to simulate instaneous population bottleneck or expansion before the split.


!!! depending on which type of model you want use, change the name of the script *call_all_model_NA_change.py* to *call_all_model_no_NA_change.py* in the bash script or in the command in the terminal !!!
## Model exemple
![Dessin_model_Nachange_noNa](https://user-images.githubusercontent.com/84977797/135247836-5f909cd9-d56e-430e-a3c8-7adb79249ef7.png)

## How to run simulation with these scripts
There is two main way to run these scripts.

### Using the bash scritp to launch multiple job

You will need to put all the scripts in one folder and then use only the bash script  **Multi_Launch_dadi.sh** .
In this following script, you have to write the name of your Spectrum file generated by *dadi* without the
``` 
FS=my_sprectrum_file_nam
``` 

them in lines of loops you will need to write each model name you want to run and the number of iteration you will performed.
In the following exemple, i run two models **SC2N2m** and **AM2N2m** for 11 iterations
``` 
for model in SC2N2m AM2N2m;
do
for i in `seq 1 11`;
do
``` 

### Direct run 
You can also run the command directly from the terminal where you will give 3 arguments to perform the simulation:

1. model used for exemple.  > **IM2m**
2. spectrum file
3. the iteration (must be an integer)

For exemple i ran a simulation for the model **IM2m** for the 9th iteration on the *noNA_change* models
```
python3 call_all_model_noNA_change.py IM2m my_spectrum_file_name 9 
```

### Writing additionnal model within these scripts

If you're new to this, see the *dadi* [tutorial page](https://dadi.readthedocs.io/en/latest/), model writing is well explained.

To add model in these scripts, whenever on which type of models you want to write (*with NA_change or no_Na_Change* scripts).
You have to open the respectively named scripts (*model_NA_change.py or model_No_NA_change.py*) and add you model as a functions at the end of theses scripts.
Then, you will have to add your model and parameters bound at the end of the  ***elif*** condition as other models


